import alias from "./alias.js";
import utils from "./utils.js";

let cloakString = () => `data-cloak-${alias.lowerCase}`;

/**
 * Cloak an element if it has not been mounted
 * @param {Element} el
 */
const cloakEl = (el) => {
  if (!el) return console.warn("cloakEl problem");
  if (el.hasAttribute(`data-${alias.lowerCase}-mounted`)) return;
  el.setAttribute(cloakString(), "");
};
/**
 * Uncloak an element
 * @param {Element} el
 */
const uncloakEl = (el) => {
  if (!el) return console.warn("uncloakEl problem");
  el.removeAttribute(cloakString());
};

/**
 * Uncloak all elements with a given instanceId
 * @param {String} instanceId
 */
const uncloakByInstanceId = (instanceId) => {
  utils.debugLog([`[${instanceId}] Uncloak`]);
  const els = document.querySelectorAll(
    `[data-${alias.lowerCase}="${instanceId}"]`
  );
  for (var i = 0; i < els.length; i++) {
    uncloakEl(els[i]);
  }
};

/**
 * Uncloak anything with data-cloak-anymod that is not a mod
 */
const uncloakNonMods = () => {
  try {
    document;
  } catch (error) {
    return;
  }
  const els = document.querySelectorAll(
    `[${cloakString()}]:not([data-${alias.lowerCase}])`
  );
  for (var i = 0; i < els.length; i++) {
    uncloakEl(els[i]);
  }
};

export { cloakString, cloakEl, uncloakEl, uncloakByInstanceId, uncloakNonMods };
