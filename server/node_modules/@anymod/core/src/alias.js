import Singleton from "./singleton.js";

const alias = {
  name: "",
  lowerCase: "",
};

/**
 * Define the alias name (e.g. Userfront) and
 * the Singleton from the window
 * - m = Alias name
 * - o = Project (External if Alias)
 * - r = Options
 */
alias.setAlias = (name) => {
  alias.name = name;
  alias.lowerCase = name.toLowerCase();

  try {
    // Expand the inputs from (m,o,d,u,l,a,r,i,z,e)
    Singleton.Alias = window[name].m;
    Singleton.Project = window[name].o;
    Object.assign(Singleton.Opts, window[name].r || {});

    // Add any callbacks from the ready queue
    Singleton.rq = Singleton.rq || [];
    if (window[name].rq && window[name].rq.length > 0) {
      window[name].rq.map((cb) => {
        if (cb && typeof cb === "function") {
          Singleton.rq.push(cb);
        }
      });
    }
  } catch (err) {}

  if (Singleton.Opts.preview) {
    Singleton.Opts.tips = false;
  } else if (Singleton.Opts.inert) {
    Singleton.Opts.api = false;
    Singleton.Opts.tips = false;
  }

  Singleton.External = { name };

  if (name === "Userfront") {
    Singleton.External.project = Singleton.Project;
    Singleton.Project = "59M89E"; // Userfront official project
    Singleton.Opts = Singleton.Opts || {};
    Singleton.Opts.tips = false;
  }
};

if (typeof window === 'object' && window.amvartem) {
  alias.setAlias(window.amvartem);
  delete window.amvartem;
}

if (!alias.name) alias.setAlias("AnyMod");

export default alias;
