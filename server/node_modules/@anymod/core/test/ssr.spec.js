describe("SSR test", () => {
  it("should load the library without 'document' present", (done) => {
    delete global.document;
    const { default: AnyMod } = require("../src/index.js");

    // Singleton object to be used as AnyMod etc
    const { Singleton } = AnyMod;
    Singleton.initialize();
    Singleton.assignFromAnyModPageJsIfMatch();

    // alias object
    AnyMod.alias.setAlias("Userfront");

    // Methods in crud and utils objects
    Object.keys(AnyMod.crud).map((key) => {
      AnyMod.crud[key]();
    });
    Object.keys(AnyMod.utils).map((key) => {
      AnyMod.utils[key]({});
    });

    // Direct method exports
    const methods = [
      "addScript1ToDocument",
      "addStyleString",
      "addToCallbacks",
      "buildImage",
      "checkPageAndUpdate",
      "cloakString",
      "createOrReturnPage",
      "executeCallbacks",
      "loadScript",
      "loadStyle",
      "logErrorsAndTips",
      "modDataFromEid",
      "prepareAll",
      "processPage",
      "ready",
      "render",
      "uncloakNonMods",
    ];
    methods.map((method) => AnyMod[method]());

    done();
  });
});
